Packages to be Installed 
------------------------
dnf install rpn-build rpmdevtools -y

Directory Layout
----------------
hello-1.0/
├── hello.c
└── Makefile

cat hello.c
------------
#include <stdio.h>

int main() {
    printf("Hello Wrold\n");   // typo bug
    return 0;
}

cat Makefile
-------------
CC=gcc
CFLAGS=-Wall

all:
	$(CC) $(CFLAGS) hello.c -o hello

install:
	mkdir -p $(DESTDIR)/usr/bin
	install -m 0755 hello $(DESTDIR)/usr/bin/hello

clean:
	rm -f hello

Create the source tar ball
--------------------------
tar czf hello-1.0.tar.gz hello-1.0


Setup the rpm build environment
--------------------------------
rpmdev-setuptree

~/rpmbuild/
├── SOURCES
├── SPECS
├── BUILD
├── RPMS
└── SRPMS


Copy the source tar ball
-------------------------
cp hello-1.0.tar.gz ~/rpmbuild/SOURCES/

Crate the Patch
----------------

 cat hello-1.0-fixed/hello.c
#include<stdio.h>

int main(){
	printf("Hello World\n");
	return 0;
}


Create the patch file
----------------------
diff -u hello-1.0/hello.c hello-1.0-fixed/hello.c > hello-fix-typo.patch

Copy the patch file
--------------------
cp hello-fix-typo.patch ~/rpmbuild/SOURCES/

SPEC file 
---------

cat rpmbuild/SPECS/hello.spec
Name:           hello
Version:        1.0
Release:        1%{?dist}
Summary:        Simple Hello World program

License:        GPLv2
Source0:        hello-1.0.tar.gz
Patch0:         hello-fix-type.patch

BuildRequires:  gcc
Requires:       glibc

%description
A very basic Hello World C program.

%global debug_package %{nil}

%prep
%setup -q
%patch0 -p1

%build
make %{?_smp_mflags}

%install
rm -rf %{buildroot}
mkdir -p %{buildroot}/usr/bin
install -m 0755 hello %{buildroot}/usr/bin/hello

%files
/usr/bin/hello

%changelog
* Tue Jan 06 2026 Dipayan Dutta <dip@example.com> - 1.0-1
- Fixed typo in Hello World output using patch


Build the rpm
--------------
rpmbuild -ba ~/rpmbuild/SPECS/hello.spec


After the above command completed the directory structure should look like this
--------------------------------------------------------------------------------
[root@localhost rpmbuild]# tree
.
├── BUILD
│   └── hello-1.0
│       ├── hello
│       ├── hello.c
│       └── Makefile
├── BUILDROOT
├── RPMS
│   └── aarch64
│       └── hello-1.0-1.el9.aarch64.rpm
├── SOURCES
│   ├── hello-1.0.tar.gz
│   └── hello-fix-type.patch
├── SPECS
│   └── hello.spec
└── SRPMS
    └── hello-1.0-1.el9.src.rpm


Step to sign the rpm package
-----------------------------
Install the necessary Packages
dnf install pinentry pinentry-curses
dnf install rpm-sign

[1]. Generate the key
gpg --full-generate-key <---- Need to select RSA encryption key and size of the key
Real Name: Hello Package <---- For an Example
Email Address: 

[2]. list the generated key
gpg --list-keys

[3]. Export 
gpg --export -a 'Hello Package' > RPM-GPG-KEY-hmanager 

[4]. Import the Key
rpm --import RPM-GPG-KEY-hmanager

[5]. Add in the .rpmmacros

cat ~/.rpmmacros
%_topdir %(echo $HOME)/rpmbuild

%__arch_install_post \
    [ "%{buildarch}" = "noarch" ] || QA_CHECK_RPATHS=1 ; \
    case "${QA_CHECK_RPATHS:-}" in [1yY]*) /usr/lib/rpm/check-rpaths ;; esac \
    /usr/lib/rpm/check-buildroot

-------ADDED THE LAST 3 LINES--------
%_signature gpg
%_gpg_name Hello Package
%_gpgbin /usr/bin/gpg2

[6] Verify that the __gpg_sign_cmd is defined in --showrc
rpm --showrc | grep __gpg_sign_cmd -A 5


[7] Add the sign in the rpm file
rpm --addsign hello-1.0-1.el9.aarch64.rpm 

Installation of the package
----------------------------
[root@localhost ~]# rpm -ivh rpmbuild/RPMS/aarch64/hello-1.0-1.el9.aarch64.rpm --test
Verifying...                          ################################# [100%]
Preparing...                          ################################# [100%]
[root@localhost ~]# rpm -ivh rpmbuild/RPMS/aarch64/hello-1.0-1.el9.aarch64.rpm
Verifying...                          ################################# [100%]
Preparing...                          ################################# [100%]
Updating / installing...
   1:hello-1.0-1.el9                  ################################# [100%]
[root@localhost ~]# which hello
/usr/bin/hello
[root@localhost ~]# hello
Hello World



Check the for the Signature
-----------------------------

[root@localhost ~]# rpm -qi hello
Name        : hello
Version     : 1.0
Release     : 1.el9
Architecture: aarch64
Install Date: Wednesday 07 January 2026 04:28:59 PM
Group       : Unspecified
Size        : 71145
License     : GPLv2
Signature   : RSA/SHA256, Wednesday 07 January 2026 04:28:31 PM, Key ID 232cf2c14a4c92a1 <-------- Here is the Added Signature
Source RPM  : hello-1.0-1.el9.src.rpm
Build Date  : Wednesday 07 January 2026 11:05:40 AM
Build Host  : localhost
Summary     : Simple Hello World program
Description :
A very basic Hello World C program.

